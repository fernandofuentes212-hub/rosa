<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camino a la Luna</title>

    <style>
        :root {
            --room1: #ffd6de;
            --room2: #e7d4ff;
            --room3: #d6f5ff;
            --w: 92vw;
            --h: 80vh;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        html, body {
            height: 100%;
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
            background: #f3f3f3;
        }

        #game {
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #stage {
            width: var(--w);
            height: var(--h);
            position: relative;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 18px 60px rgba(6,10,20,0.15);
            touch-action: none;
            background: transparent;
        }

        /* ROOMS */
        .room {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity .6s ease;
        }

            .room.active {
                opacity: 1;
                pointer-events: auto;
                z-index: 1;
            }

        .room1 {
            background: linear-gradient(180deg,var(--room1),#ffeef2)
        }

        .room2 {
            background: linear-gradient(180deg,var(--room2),#f6f0ff)
        }

        .room3 {
            background: linear-gradient(180deg,var(--room3),#eefbff)
        }

        .room4 {
            background: #041224;
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

            /* estrellas más densas */
            .room4::before,
            .room4::after {
                content: "";
                position: absolute;
                inset: 0;
                pointer-events: none;
            }

            .room4::before {
                background-image: radial-gradient(circle at 5% 10%, white 0 1px, transparent 1px), radial-gradient(circle at 15% 30%, white 0 1px, transparent 1px), radial-gradient(circle at 25% 80%, white 0 1px, transparent 1px), radial-gradient(circle at 50% 20%, white 0 1px, transparent 1px), radial-gradient(circle at 70% 10%, white 0 1px, transparent 1px), radial-gradient(circle at 80% 50%, white 0 1px, transparent 1px), radial-gradient(circle at 35% 60%, white 0 1px, transparent 1px), radial-gradient(circle at 60% 75%, white 0 1px, transparent 1px), radial-gradient(circle at 10% 50%, white 0 1px, transparent 1px), radial-gradient(circle at 20% 15%, white 0 1px, transparent 1px), radial-gradient(circle at 45% 40%, white 0 1px, transparent 1px), radial-gradient(circle at 75% 65%, white 0 1px, transparent 1px);
                opacity: 0.8;
                animation: twinkle 4s ease-in-out infinite;
            }

            .room4::after {
                background-image: radial-gradient(circle at 10% 20%, white 0 2px, transparent 2px), radial-gradient(circle at 30% 40%, white 0 2px, transparent 2px), radial-gradient(circle at 45% 60%, white 0 2px, transparent 2px), radial-gradient(circle at 65% 30%, white 0 2px, transparent 2px), radial-gradient(circle at 80% 70%, white 0 2px, transparent 2px), radial-gradient(circle at 20% 80%, white 0 2px, transparent 2px), radial-gradient(circle at 55% 15%, white 0 2px, transparent 2px), radial-gradient(circle at 90% 50%, white 0 2px, transparent 2px);
                opacity: 0.9;
                animation: twinkle 6s ease-in-out infinite;
            }

        @keyframes twinkle {
            0% {
                opacity: .4
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: .4
            }
        }

        /* luna cuarto menguante */
        .moon {
            position: absolute;
            top: 18%;
            right: 15%;
            width: 90px;
            height: 90px;
            border-radius: 100%;
            background: #fff;
            box-shadow: 0 0 30px rgba(255,255,255,.5);
            overflow: hidden;
        }

            .moon::after {
                content: "";
                position: absolute;
                inset: 0;
                border-radius: 50%;
                background: #041224; /* color del cielo */
                transform: translateX(25%); /* sombra para cuarto menguante */
            }

        /* link oculto */
        .moon-link {
            position: absolute;
            top: 40%;
            right: 14%;
            color: #fff;
            font-weight: bold;
            text-decoration: none;
            padding: 10px 16px;
            border: 2px solid #fff;
            border-radius: 20px;
            opacity: 0;
            transition: .5s;
        }

            .moon-link.show {
                opacity: 1;
            }

        /* corazón */
        #heart {
            position: absolute;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            transform: translate(-50%,-50%);
            animation: beat 1.2s infinite;
            z-index: 10;
        }

        @keyframes beat {
            0% {
                transform: translate(-50%,-50%) scale(1)
            }

            50% {
                transform: translate(-50%,-50%) scale(1.2)
            }

            100% {
                transform: translate(-50%,-50%) scale(1)
            }
        }

        /* guías */
        .guide {
            position: absolute;
            background: #fff;
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: bold;
            transition: all .3s;
        }

            /* posiciones según dirección */
            .guide.right {
                top: 50%;
                right: 20px;
                transform: translateY(-50%);
            }

            .guide.down {
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
            }

            .guide.left {
                top: 50%;
                left: 20px;
                transform: translateY(-50%);
            }
    </style>
</head>

<body>

    <div id="game">
        <div id="stage">

            <div class="room room1 active">
                <div class="guide right">Por aquí ⏩</div>
            </div>

            <div class="room room2">
                <div class="guide down">Por aquí ⏬</div>
            </div>

            <div class="room room3">
                <div class="guide left">Por aquí ⏪</div>
            </div>

            <div class="room room4">
                <div class="moon" id="moon"></div>
                <a href="https://www.google.com" target="_blank" class="moon-link" id="moonLink">
                    Descubre la sorpresa 🌙
                </a>
            </div>

            <div id="heart">❤️</div>

        </div>
    </div>

    <script>
        const rooms = document.querySelectorAll('.room');
        const heart = document.getElementById('heart');
        const stage = document.getElementById('stage');
        const moon = document.getElementById('moon');
        const moonLink = document.getElementById('moonLink');

        let current = 0;
        let pos = { x: 200, y: 200 };
        const SPEED = 4;
        let keys = {};

        /* teclado PC */
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        /* mover con dedo */
        stage.addEventListener("touchmove", e => {
            if (current >= 3) return;
            const touch = e.touches[0];
            const rect = stage.getBoundingClientRect();
            pos.x = touch.clientX - rect.left;
            pos.y = touch.clientY - rect.top;
        });

        /* colisión */
        function isColliding(a, b) {
            return !(
                a.right < b.left ||
                a.left > b.right ||
                a.bottom < b.top ||
                a.top > b.bottom
            );
        }

        function checkInteractions() {
            const heartRect = heart.getBoundingClientRect();

            /* cambiar room */
            if (current < 3) {
                const guide = rooms[current].querySelector('.guide');
                const guideRect = guide.getBoundingClientRect();
                if (isColliding(heartRect, guideRect)) {
                    showRoom(current + 1);
                }
            }

            /* luna */
            if (current === 3) {
                const moonRect = moon.getBoundingClientRect();
                if (isColliding(heartRect, moonRect)) {
                    moonLink.classList.add("show");
                }
            }
        }

        function centerHeart() {
            const rect = stage.getBoundingClientRect();
            pos.x = rect.width / 2;
            pos.y = rect.height / 2;
            heart.style.left = pos.x + "px";
            heart.style.top = pos.y + "px";
        }

        function showRoom(i) {
            rooms[current].classList.remove('active');
            current = i;
            rooms[current].classList.add('active');

            centerHeart();
            moonLink.classList.remove("show");

            /* ocultar corazón en último room */
            if (current === 3) {
                heart.style.display = "none";
            } else {
                heart.style.display = "flex";
            }
        }

        function update() {
            if (current < 3) {
                if (keys["ArrowUp"]) pos.y -= SPEED;
                if (keys["ArrowDown"]) pos.y += SPEED;
                if (keys["ArrowLeft"]) pos.x -= SPEED;
                if (keys["ArrowRight"]) pos.x += SPEED;
            }

            const rect = stage.getBoundingClientRect();
            const margin = 30;

            pos.x = Math.max(margin, Math.min(rect.width - margin, pos.x));
            pos.y = Math.max(margin, Math.min(rect.height - margin, pos.y));

            heart.style.left = pos.x + "px";
            heart.style.top = pos.y + "px";

            if (current < 3) {
                checkInteractions();
            }

            requestAnimationFrame(update);
        }

        centerHeart();
        update();
    </script>

</body>
</html>
